{"version":3,"sources":["app.js"],"names":["window","document","undefined","angular","module","config","$urlRouterProvider","localStorageServiceProvider","cfpLoadingBarProvider","otherwise","setPrefix","includeSpinner","toastr","options","closeButton","debug","newestOnTop","progressBar","positionClass","preventDuplicates","onclick","showDuration","hideDuration","timeOut","extendedTimeOut","showEasing","hideEasing","showMethod","hideMethod","run","localStorageService","articles","$rootScope","$log","getAllArticles","then","response","$emit","set","error","data","get","controller","$scope","$http","$state","remove","$on","event","toState","toParams","currentStateName","name","currentStateParams","info","countCartItems","getUserData","genres","logout","success","go","user","userName","userRole","role","cart","quantity","forEach","item","itemId","$stateProvider","state","url","templateUrl","isFormTouched","isLoading","username","toCheckout","password","$","keydown","keyCode","click","login","id","parseInt","warning","$stateParams","getArticles","isArticles","genre","push","isAllGenres","searchInput","relevance","value","reverse","priceDesc","priceAsc","newest","preselected","orderType","optionChange","checkPlatforms","selected","platform","bool","key","validatePrice","input","test","currentUser","equals","authenticate","fsk","isTouched","isPriceInvalid","isPriceTouched","isCustomGenre","genreButtonText","changeInputStyle","priceValidation","price","imageToBase64","files","reader","FileReader","onload","e","image","target","result","$apply","readAsDataURL","isInt","n","Number","isFloat","parseFloat","titleRegex","genreRegex","languageRegex","descriptionRegex","addArticle","title","customGenre","description","wiiu","windows","ps","xbox","osx","release","language","minRam","minProcessor","date","Date","getTime","platforms","toString","newGameIds","orders","getOrders","factory","$q","$filter","trimPlatforms","trimmed","trim","service","q","defer","reject","mapped","_mapArticles","getNewGames","resolve","statusText","promise","ID","Name","Genre","Preis","FSK","Plattformen","Release","Sprache","Beschreibung","Rezensionen","post","addReview","idArticle","articleId","stars","Autor","author","Titel","Text","message","Datum","getTopGames","top","articlesArray","sorted","sliced","slice","newGamesIds","mappedItems","isNewGenre","mappedItem","reviews","_mapReviews","_mapOrders","order","mappedOrder","userId","idUser","totalPrice","Bestellungsartikel","Anzahl","mapCartItems","idOrder","addOrder","items","md5","_mapUsers","Benutzername","email","Email","Rolle","addUser","Passwort","warn","createHash","getAllUsers","users","md5Password","deleteUser","topGameIds","isInvalid","updateTotalPrice","quantityChange","newQuantity","loadUsers","confirm","$uibModal","loadGame","actualGame","calculateAverageStars","getElementById","innerHTML","calcPrice","count","reviewsCount","tab","active","isValidQuantity","isNaN","Math","round","current","changeTab","type","toCart","starsActivator","numbers","i","starHover","number","leave","rate","newReviewId","review","modalInstance","open","animation","highestFsk","isAgeConfirmed","ageConfirmedChange","$uibModalInstance","isNewReview","isTitleTouched","isMessageTouched","messageRegex","checkValid","isValid","submit","close","cancel","dismiss","passwordConfirm","pattern","userRegex","passwordRegex","register"],"mappings":"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","file":"app.min.js","sourcesContent":["(function(window, document, undefined) {\n'use strict';\nangular.module('app', [\r\n    'ui.router',\r\n    'ui.bootstrap',\r\n    'LocalStorageModule',\r\n    'ngAnimate',\r\n    'templates',\r\n    'textAngular',\r\n    'angular-md5',\r\n    'angular-loading-bar',\r\n    // 'ngSanitize',\r\n    'app.home',\r\n    'app.addArticle',\r\n    'app.topGames',\r\n    'app.newGames',\r\n    'app.gameDetail',\r\n    'app.login',\r\n    'app.genre',\r\n    'app.cart',\r\n    'app.checkout',\r\n    'app.orders',\r\n    'app.userAdministration',\r\n    'app.register'\r\n])\r\n    .config([\"$urlRouterProvider\", \"localStorageServiceProvider\", \"cfpLoadingBarProvider\", function ($urlRouterProvider, localStorageServiceProvider, cfpLoadingBarProvider) {\r\n        $urlRouterProvider.otherwise('/home');\r\n        localStorageServiceProvider.setPrefix('webshop');\r\n        cfpLoadingBarProvider.includeSpinner = false;\r\n        toastr.options = {\r\n            \"closeButton\": false,\r\n            \"debug\": false,\r\n            \"newestOnTop\": false,\r\n            \"progressBar\": false,\r\n            \"positionClass\": \"toast-bottom-right\",\r\n            \"preventDuplicates\": false,\r\n            \"onclick\": null,\r\n            \"showDuration\": \"300\",\r\n            \"hideDuration\": \"1000\",\r\n            \"timeOut\": \"5000\",\r\n            \"extendedTimeOut\": \"1000\",\r\n            \"showEasing\": \"swing\",\r\n            \"hideEasing\": \"linear\",\r\n            \"showMethod\": \"fadeIn\",\r\n            \"hideMethod\": \"fadeOut\"\r\n        }\r\n    }])\r\n    .run([\"localStorageService\", \"articles\", \"$rootScope\", \"$log\", function (localStorageService, articles, $rootScope, $log) {\r\n        articles.getAllArticles()\r\n            .then(function (response) {\r\n                $rootScope.$emit('genresLoaded');\r\n                localStorageService.set('articles', response);\r\n            }, function (error) {\r\n                var data = localStorageService.get('articles');\r\n                if (data) {\r\n                    toastr.error('Artikel konnten nicht neu geladen werden. Daten wurden aus dem Cache geladen.')\r\n                } else {\r\n                    toastr.error('Artikel konnten nicht geladen werden.');\r\n                }\r\n                $log.error(error);\r\n            });\r\n        localStorageService.set('fromCheckout', false);\r\n    }])\r\n    // controller for the navbar\r\n    .controller('AppCtrl', [\"$scope\", \"$rootScope\", \"$http\", \"localStorageService\", \"$state\", \"articles\", \"$log\", function ($scope, $rootScope, $http, localStorageService, $state, articles, $log) {\r\n        localStorageService.remove('checkout');\r\n        $rootScope.$on('$stateChangeSuccess',\r\n            function (event, toState, toParams) {\r\n                $scope.currentStateName = toState.name;\r\n                $scope.currentStateParams = toParams.name;\r\n            });\r\n\r\n        $rootScope.$on('itemAddedToCart', function () {\r\n            $log.info(\"cart changed\");\r\n            countCartItems();\r\n        });\r\n\r\n        $rootScope.$on('login', function () {\r\n            getUserData();\r\n        });\r\n\r\n        // load genres initially and when articles are loaded\r\n        $scope.genres = localStorageService.get(\"genres\");\r\n        $rootScope.$on(\"articles-loaded\", function () {\r\n            $scope.genres = localStorageService.get(\"genres\");\r\n        });\r\n\r\n        $rootScope.logout = function () {\r\n            localStorageService.remove('user');\r\n            localStorageService.remove('orders');\r\n            localStorageService.remove('checkout');\r\n            // update user data\r\n            $rootScope.$emit('login');\r\n            $rootScope.$emit('itemAddedToCart');\r\n            toastr.success('Logout war erfolgreich.');\r\n            $state.go('login');\r\n        };\r\n\r\n        // get user data, display user name in navbar, show more options in navbar if the user is an admin\r\n        var getUserData = function () {\r\n            var user = localStorageService.get('user') || {};\r\n            $scope.userName = user.userName || 'Benutzer';\r\n            $scope.userRole = user.role;\r\n        };\r\n        getUserData();\r\n\r\n        // count the total items in the cart\r\n        var countCartItems = function () {\r\n            var cart = localStorageService.get('cart');\r\n            $scope.quantity = 0;\r\n            var articles = localStorageService.get('articles') || {};\r\n            angular.forEach(cart, function (item) {\r\n                if (articles[item.itemId]) {\r\n                    $scope.quantity += item.quantity;\r\n                } else {\r\n                    // remove items from cart which have no valid article ID\r\n                    delete cart[item.itemId];\r\n                }\r\n            });\r\n            localStorageService.set('cart', cart);\r\n        };\r\n        countCartItems();\r\n    }]);\n\r\nangular.module('app.login', [])\r\n\r\n    .config([\"$stateProvider\", function ($stateProvider) {\r\n        $stateProvider.state('login', {\r\n            url : '/login',\r\n            templateUrl : 'app/login/login.html',\r\n            controller : 'LoginCtrl'\r\n        });\r\n    }])\r\n\r\n    .controller('LoginCtrl', [\"$scope\", \"$state\", \"localStorageService\", \"$rootScope\", \"$http\", \"user\", function ($scope, $state, localStorageService, $rootScope, $http, user) {\r\n        $scope.isFormTouched = false;\r\n        $scope.isLoading = false;\r\n\r\n        var username = localStorageService.get('user') || {};\r\n        var toCheckout = localStorageService.get('fromCheckout');\r\n        if (username.userName) {\r\n            toastr.info('Sie sind bereits eingeloogt als \"' + username.userName + '\"!');\r\n            $state.go('home');\r\n        }\r\n        $scope.data = {};\r\n        $scope.data.password = '';\r\n        $scope.data.userName = '';\r\n\r\n        //Trigger Login when enter pressed\r\n        $(\"#form\").keydown(function (event) {\r\n            if (event.keyCode == 13) {\r\n                $(\"#submit\").click();\r\n            }\r\n        });\r\n\r\n        $scope.login = function () {\r\n            $scope.isFormTouched = true;\r\n            if (!$scope.data.userName || !$scope.data.password) {\r\n                toastr.warning('<img src=\"assets/img/Epic_Mass_Facepalm.gif\"/>');\r\n                toastr.warning('You had one Job!');\r\n            } else {\r\n                $scope.isLoading = true;\r\n                var data = {\r\n                    userName : $scope.data.userName,\r\n                    password : $scope.data.password\r\n                };\r\n                user.login(data)\r\n                    .then(function (response) {\r\n                        $scope.isLoading = false;\r\n                        toastr.success('Login war erfolgreich.');\r\n                        var user = {\r\n                            userName : $scope.data.userName,\r\n                            role : response.role,\r\n                            id : parseInt(response.id),\r\n                            // md5 encrypted\r\n                            password : response.password\r\n                        };\r\n                        localStorageService.set('user', user);\r\n                        $rootScope.$emit('login');\r\n                        localStorageService.remove('fromCheckout');\r\n                        if (toCheckout) {\r\n                            $state.go('checkout');\r\n                        } else {\r\n                            $state.go('home');\r\n                        }\r\n                    }, function (error) {\r\n                        $scope.isLoading = false;\r\n                        if (error) {\r\n                            toastr.error(error);\r\n                        } else {\r\n                            toastr.error(\"Fehler bei der Verbindung zum Server!\");\r\n                        }\r\n                    });\r\n            }\r\n        }\r\n    }]);\n\r\nangular.module('app.genre', [])\r\n\r\n    .config([\"$stateProvider\", function ($stateProvider) {\r\n        $stateProvider.state('genre', {\r\n            url : '/genre/:name',\r\n            templateUrl : 'app/genre/genre.html',\r\n            controller : 'GenreCtrl'\r\n        });\r\n    }])\r\n\r\n    .controller('GenreCtrl', [\"$stateParams\", \"localStorageService\", \"$scope\", \"articles\", function ($stateParams, localStorageService, $scope, articles) {\r\n        $scope.searchInput = \"\";\r\n        $scope.isAllGenres = false;\r\n\r\n        // get genre from URL parameters\r\n        $scope.genre = $stateParams.name;\r\n\r\n        function getArticles() {\r\n            // all articles\r\n            var articles = localStorageService.get('articles');\r\n\r\n            // only articles with matching genre\r\n            $scope.articles = [];\r\n\r\n            $scope.isArticles = false;\r\n            // convert from objects to array to be able to order\r\n            angular.forEach(articles, function (item) {\r\n                if (item.genre == $scope.genre) {\r\n                    $scope.isArticles = true;\r\n                    $scope.articles.push(item);\r\n                } else if ($scope.genre == 'Alle Spiele') {\r\n                    $scope.articles.push(item);\r\n                    $scope.isArticles = true;\r\n                    $scope.isAllGenres = true;\r\n                }\r\n            });\r\n        }\r\n        getArticles();\r\n\r\n        articles.getAllArticles()\r\n            .then(function () {\r\n                getArticles();\r\n            });\r\n\r\n        // set order values\r\n        $scope.relevance = {\r\n            name: \"relevance\",\r\n            value: \"id\",\r\n            reverse: false\r\n        };\r\n        $scope.priceDesc = {\r\n            name: \"priceDesc\",\r\n            value: \"price\",\r\n            reverse: true\r\n        };\r\n        $scope.priceAsc = {\r\n            name: \"priceAsc\",\r\n            value: \"price\",\r\n            reverse: false\r\n        };\r\n        $scope.newest = {\r\n            name: \"newest\",\r\n            value: \"release\",\r\n            reverse: true\r\n        };\r\n\r\n        // set initial order type\r\n        var preselected = localStorageService.get(\"order-option\") || \"relevance\";\r\n        $scope.orderType = $scope[preselected];\r\n\r\n        // write option to localstorage\r\n        // when user re-enters the site, preselected option is re-loaded\r\n        $scope.optionChange = function () {\r\n            localStorageService.set(\"order-option\", $scope.orderType.name);\r\n        }\r\n    }]);\n\r\nangular.module('app.addArticle', [])\r\n\r\n    .config([\"$stateProvider\", function ($stateProvider) {\r\n        $stateProvider.state('addArticle', {\r\n            url : '/addArticle',\r\n            templateUrl : 'app/addArticle/addArticle.html',\r\n            controller : 'AddArticleCtrl'\r\n        });\r\n    }])\r\n\r\n    .controller('AddArticleCtrl', [\"$scope\", \"articles\", \"$log\", \"$state\", \"localStorageService\", \"user\", \"$rootScope\", function ($scope, articles, $log, $state, localStorageService, user, $rootScope) {\r\n        var currentUser = localStorageService.get(\"user\") || {};\r\n        if (angular.equals({}, currentUser)) {\r\n            toastr.info(\"Sie müssen sich einloggen, um diese Seite zu sehen\");\r\n            $state.go(\"login\");\r\n        } else {\r\n            user.authenticate(currentUser.userName, currentUser.password)\r\n                .then(function (response) {\r\n                    localStorageService.set(\"user\", response);\r\n                    currentUser = response;\r\n                    if (currentUser.role != \"admin\") {\r\n                        toastr.info(\"Diese Seite ist geschützt!\");\r\n                        $state.go(\"home\");\r\n                    }\r\n                }, function () {\r\n                    toastr.error(\"Fehler bei der Authentifizierung\");\r\n                    toastr.warning(\"Sie werden nun automatisch ausgeloggt\");\r\n                    $rootScope.logout();\r\n                });\r\n        }\r\n        $scope.selected = {};\r\n        $scope.selected.platform = {};\r\n        $scope.selected.fsk = '0';\r\n        $scope.isTouched = false;\r\n        $scope.isPriceInvalid = false;\r\n        $scope.isPriceTouched = false;\r\n        $scope.isCustomGenre = false;\r\n        $scope.genreButtonText = 'Neues Genre anlegen';\r\n        $scope.isLoading = false;\r\n\r\n        // function that returns all selected checkboxes\r\n        function checkPlatforms() {\r\n            var selected = [];\r\n            angular.forEach($scope.selected.platform, function (bool, key) {\r\n                if (bool) {\r\n                    selected.push(key);\r\n                }\r\n            });\r\n            return selected;\r\n        }\r\n\r\n        $scope.genres = localStorageService.get(\"genres\") || [];\r\n        articles.getAllArticles()\r\n            .then(function () {\r\n                $scope.genres = localStorageService.get(\"genres\") || [];\r\n            }, function (error) {\r\n                toastr.error(error);\r\n            });\r\n\r\n        function validatePrice(input) {\r\n            return /(?=.)^\\$?(([1-9][0-9]{0,2}(,[0-9]{3})*)|[0-9]+)?(\\.[0-9]{1,2})?$/.test(input);\r\n        }\r\n\r\n        // toggle between selecting existing genres and typing in a new genre\r\n        $scope.changeInputStyle = function () {\r\n            $scope.isCustomGenre ? $scope.isCustomGenre = false : $scope.isCustomGenre = true;\r\n            $scope.genreButtonText == 'Neues Genre anlegen' ? $scope.genreButtonText = 'Vorhandenes Genre auswählen' : $scope.genreButtonText = 'Neues Genre anlegen';\r\n        };\r\n\r\n        $scope.priceValidation = function () {\r\n            $scope.isPriceTouched = true;\r\n            !validatePrice($scope.price) ? $scope.isPriceInvalid = true : $scope.isPriceInvalid = false;\r\n        };\r\n\r\n        $scope.imageToBase64 = function (input) {\r\n            if (input.files && input.files[0]) {\r\n                var reader = new FileReader();\r\n\r\n                reader.onload = function (e) {\r\n                    $log.info('image successfully converted to Base64');\r\n                    $scope.image = e.target.result;\r\n                    $scope.$apply();\r\n                };\r\n\r\n                reader.readAsDataURL(input.files[0]);\r\n            }\r\n        };\r\n\r\n        $scope.isInt = function (n) {\r\n            n = parseInt(n);\r\n            return Number(n) === n && n % 1 === 0;\r\n        };\r\n\r\n        $scope.isFloat = function (n) {\r\n            n = parseFloat(n);\r\n            return Number(n) === n && n % 1 !== 0;\r\n        };\r\n\r\n        $scope.titleRegex = /^.{4,60}$/;\r\n        $scope.genreRegex = /^.{4,20}$/;\r\n        $scope.languageRegex = /^.{4,15}$/;\r\n        $scope.descriptionRegex = /^[^']{1,8000}$/;\r\n\r\n        $scope.addArticle = function () {\r\n            $scope.isTouched = true;\r\n            $scope.isPriceTouched = true;\r\n            $scope.isPriceInvalid = false;\r\n\r\n            if ($scope.title && (($scope.selected.genre && !$scope.isCustomGenre) || ($scope.customGenre && $scope.isCustomGenre && $scope.genreRegex.test($scope.customGenre)))\r\n                && $scope.price && $scope.descriptionRegex.test($scope.description) && ($scope.selected.platform.wiiu ||\r\n                $scope.selected.platform.windows || $scope.selected.platform.ps || $scope.selected.platform.xbox ||\r\n                $scope.selected.platform.osx) && $scope.release && $scope.language && $scope.minRam && $scope.languageRegex.test($scope.language) &&\r\n                $scope.minProcessor && $scope.description && $scope.image && $scope.titleRegex.test($scope.title)) {\r\n                if (!validatePrice($scope.price)) {\r\n                    toastr.warning('Ungültiger Preis!');\r\n                    $scope.isPriceInvalid = true;\r\n                } else if (!$scope.isInt($scope.minRam)) {\r\n                    toastr.warning('Der Arbeitsspeicher muss mit einer natürlichen Zahl angegeben werden!');\r\n                } else if (!$scope.isFloat($scope.minProcessor) && !$scope.isInt($scope.minProcessor)) {\r\n                    toastr.warning('Der Prozessor muss mit einer Zahl angegeben werden! Für Nachkommastellen den Punkt verwenden!');\r\n                } else {\r\n                    $scope.isLoading = true;\r\n                    var date = new Date($scope.release).getTime();\r\n                    var data = {\r\n                        id : 2,\r\n                        name : $scope.title,\r\n                        genre : $scope.isCustomGenre ? $scope.customGenre : $scope.selected.genre,\r\n                        price : $scope.price,\r\n                        fsk : $scope.selected.fsk,\r\n                        platforms : checkPlatforms(),\r\n                        release : date.toString(),\r\n                        language : $scope.language,\r\n                        minRam : $scope.minRam,\r\n                        minProcessor : $scope.minProcessor,\r\n                        description : $scope.description,\r\n                        image : $scope.image\r\n                    };\r\n                    articles.addArticle(data)\r\n                        .then(function (response) {\r\n                            $scope.isLoading = false;\r\n                            toastr.success(response);\r\n                            $state.go(\"home\");\r\n                        }, function (error) {\r\n                            $scope.isLoading = false;\r\n                            if (!error) {\r\n                                toastr.error(\"Ein unbekannter Fehler ist aufgetreten!\");\r\n                            } else {\r\n                                toastr.error(error);\r\n                            }\r\n                        })\r\n                }\r\n            } else {\r\n                toastr.warning('Fehlende oder fehlerhafte Angaben!');\r\n            }\r\n        }\r\n    }]);\n\r\nangular.module('app.home', [])\r\n\r\n    .config([\"$stateProvider\", function ($stateProvider) {\r\n        $stateProvider.state('home', {\r\n            url: '/home',\r\n            templateUrl: 'app/home/home.html',\r\n            controller: 'HomeCtrl'\r\n        });\r\n    }])\r\n\r\n    .controller('HomeCtrl', function () {\r\n\r\n    });\n\r\nangular.module('app.newGames', [])\r\n\r\n    .config([\"$stateProvider\", function ($stateProvider) {\r\n        $stateProvider.state('newGames', {\r\n            url: '/newGames',\r\n            templateUrl: 'app/newGames/newGames.html',\r\n            controller: 'NewGamesCtrl'\r\n        });\r\n    }])\r\n\r\n    .controller('NewGamesCtrl', [\"$scope\", \"articles\", \"localStorageService\", function ($scope, articles, localStorageService) {\r\n        $scope.newGameIds = localStorageService.get(\"new-games\") || [];\r\n        $scope.articles = localStorageService.get(\"articles\") || {};\r\n        articles.getAllArticles()\r\n            .then(function () {\r\n                $scope.newGameIds = localStorageService.get(\"new-games\");\r\n                $scope.articles = localStorageService.get(\"articles\");\r\n            }, function (error) {\r\n                toastr.error(error);\r\n            });\r\n    }]);\n\r\nangular.module('app.orders', [])\r\n\r\n    .config([\"$stateProvider\", function ($stateProvider) {\r\n        $stateProvider.state('orders', {\r\n            url: '/orders',\r\n            templateUrl: 'app/orders/orders.html',\r\n            controller: 'OrdersCtrl'\r\n        });\r\n    }])\r\n\r\n    .controller('OrdersCtrl', [\"$scope\", \"$http\", \"localStorageService\", \"$state\", \"orders\", \"user\", \"$rootScope\", function ($scope, $http, localStorageService, $state, orders, user, $rootScope) {\r\n        var currentUser = localStorageService.get(\"user\") || {};\r\n        $scope.articles = localStorageService.get(\"articles\") || {};\r\n        if (angular.equals({}, currentUser)) {\r\n            toastr.info(\"Sie müssen sich einloggen, um diese Seite zu sehen\");\r\n            $state.go(\"login\");\r\n        } else {\r\n            user.authenticate(currentUser.userName, currentUser.password)\r\n                .then(function (response) {\r\n                    localStorageService.set(\"user\", response);\r\n                    currentUser = response;\r\n                    orders.getOrders(currentUser.id)\r\n                        .then(function (response) {\r\n                            $scope.orders = response;\r\n                        }, function (error) {\r\n                            if (error) {\r\n                                toastr.error(error);\r\n                            } else {\r\n                                toastr.error(\"Ein unbekannter Fehler ist aufgetreten!\");\r\n                            }\r\n                        });\r\n                }, function () {\r\n                    toastr.error(\"Fehler bei der Authentifizierung\");\r\n                    toastr.warning(\"Sie werden nun automatisch ausgeloggt\");\r\n                    $rootScope.logout();\r\n                });\r\n        }\r\n    }]);\n\r\nangular.module('app')\r\n    .factory('articles', [\"$q\", \"$http\", \"localStorageService\", \"$rootScope\", \"$log\", \"$filter\", function ($q, $http, localStorageService, $rootScope, $log, $filter) {\r\n        var service = {};\r\n\r\n        service.getAllArticles = function () {\r\n            var q = $q.defer();\r\n            $http.get('http://localhost:8080/rest/article/get/all')\r\n                .then(function (response) {\r\n                    if (typeof response.data == 'string') {\r\n                        $log.error('loading articles failed: ', response.data);\r\n                        q.reject(response.data);\r\n                    } else {\r\n                        var mapped = _mapArticles(response.data);\r\n                        localStorageService.set('articles', mapped);\r\n                        $rootScope.$emit(\"articles-loaded\");\r\n                        $log.info(\"articles loaded\");\r\n                        service.getNewGames(mapped);\r\n                        q.resolve(mapped);\r\n                    }\r\n                }, function (error) {\r\n                    $log.error('loading articles failed: ', error);\r\n                    q.reject(error.statusText);\r\n                });\r\n            return q.promise;\r\n        };\r\n\r\n        service.addArticle = function (input) {\r\n            var q = $q.defer();\r\n            var data = {\r\n                ID : input.id.toString(),\r\n                Name : input.name,\r\n                Genre : input.genre,\r\n                Preis : input.price,\r\n                FSK : input.fsk,\r\n                Plattformen : input.platforms,\r\n                Release : input.release,\r\n                Sprache : input.language,\r\n                minRam : parseInt(input.minRam),\r\n                minProcessor : parseFloat(input.minProcessor),\r\n                Beschreibung : input.description,\r\n                image : input.image,\r\n                Rezensionen : []\r\n            };\r\n            $http.post('http://localhost:8080/rest/article/add', data)\r\n                .then(function (response) {\r\n                    if (response.data == \"Artikel existiert bereits\") {\r\n                        $log.error(\"error adding article: \", response.data);\r\n                        q.reject(response.data);\r\n                    } else if (response.data == \"Artikel konnte nicht hinzugefügt werden\") {\r\n                        $log.error(\"error adding article: \", response.data);\r\n                        q.reject(response.data);\r\n                    } else {\r\n                        $log.info(\"adding article was successful\");\r\n                        service.getAllArticles();\r\n                        q.resolve(response.data);\r\n                    }\r\n                }, function (error) {\r\n                    $log.error(\"error adding article: \", error);\r\n                    q.reject(error.statusText);\r\n                });\r\n            return q.promise;\r\n        };\r\n\r\n        service.addReview = function (input) {\r\n            var q = $q.defer();\r\n            var date = new Date().getTime();\r\n            var data = {\r\n                ID : '0',\r\n                idArticle : input.articleId.toString(),\r\n                stars : input.stars.toString(),\r\n                Autor : input.author,\r\n                Titel : input.title,\r\n                Text : input.message,\r\n                Datum : date.toString()\r\n            };\r\n            $http.post('http://localhost:8080/rest/review/add', data)\r\n                .then(function (response) {\r\n                    if (response.data == 'Rezension konnte nicht hinzugefügt werden') {\r\n                        $log.error(\"error adding review: \", response.data);\r\n                        q.reject(response.data);\r\n                    } else {\r\n                        $log.info(\"adding review was successful\");\r\n                        service.getAllArticles();\r\n                        q.resolve(response.data);\r\n                    }\r\n                }, function (error) {\r\n                    $log.error(\"error adding review: \", error);\r\n                    q.reject(error.statusText);\r\n                });\r\n            return q.promise;\r\n        };\r\n\r\n        service.getTopGames = function () {\r\n            var q = $q.defer();\r\n            $http.get(\"http://localhost:8080/rest/article/get/top\")\r\n                .then(function (response) {\r\n                    if (typeof response.data == 'string') {\r\n                        $log.error(\"error getting top games: \", response.data);\r\n                        q.reject(response.data);\r\n                    } else {\r\n                        var top = [];\r\n                        angular.forEach(response.data, function (item) {\r\n                            top.push(parseInt(item.ID));\r\n                            localStorageService.set(\"top-games\", top);\r\n                        });\r\n                        $log.info(\"top games loaded\");\r\n                        q.resolve(top);\r\n                    }\r\n                }, function (error) {\r\n                    $log.error(\"error getting top games: \", error);\r\n                    q.reject(error.statusText);\r\n                });\r\n            return q.promise;\r\n        };\r\n\r\n        service.getNewGames = function (articles) {\r\n            var articlesArray = [];\r\n            angular.forEach(articles, function (item) {\r\n                item.release = parseInt(item.release);\r\n                articlesArray.push(item);\r\n            });\r\n            // sort articles by release date\r\n            var sorted = $filter('orderBy')(articlesArray, 'release', true);\r\n\r\n            // only take the top 5 elements\r\n            var sliced = sorted.slice(0, 5);\r\n            var newGamesIds = [];\r\n\r\n            // only save the id's to prevent redundant data\r\n            angular.forEach(sliced, function (item) {\r\n                newGamesIds.push(item.id);\r\n            });\r\n            localStorageService.set(\"new-games\", newGamesIds);\r\n        };\r\n\r\n\r\n        var _mapArticles = function (articles) {\r\n            var mappedItems = {};\r\n            var genres = [];\r\n\r\n            angular.forEach(articles, function (item) {\r\n                // check if current genre is a new genre\r\n                var isNewGenre = true;\r\n                angular.forEach(genres, function (genre) {\r\n                    if (item.Genre == genre) {\r\n                        isNewGenre = false;\r\n                    }\r\n                });\r\n\r\n                var mappedItem = {\r\n                    id : parseInt(item.ID),\r\n                    name : item.Name,\r\n                    genre : item.Genre,\r\n                    price : parseFloat(item.Preis),\r\n                    fsk : parseInt(item.FSK),\r\n                    platforms : trimPlatforms(item.Plattformen),\r\n                    release : item.Release,\r\n                    language : item.Sprache,\r\n                    minRam : item.minRam,\r\n                    minProcessor : item.minProcessor,\r\n                    image : item.image,\r\n                    description : item.Beschreibung,\r\n                    reviews : _mapReviews(item.Rezensionen)\r\n                };\r\n                if (isNewGenre) {\r\n                    genres.push(mappedItem.genre);\r\n                }\r\n                mappedItems[mappedItem.id] = mappedItem;\r\n            });\r\n            localStorageService.set('genres', genres);\r\n            return mappedItems;\r\n        };\r\n\r\n        // remove spaces\r\n        function trimPlatforms(input) {\r\n            var trimmed = [];\r\n            angular.forEach(input, function (item) {\r\n                trimmed.push(item.trim());\r\n            });\r\n            return trimmed;\r\n        }\r\n\r\n        var _mapReviews = function (reviews) {\r\n            var mappedItems = [];\r\n            angular.forEach(reviews, function (item) {\r\n                var mappedItem = {\r\n                    id : parseInt(item.ID),\r\n                    stars : parseInt(item.stars),\r\n                    author : item.Autor,\r\n                    title : item.Titel,\r\n                    message : item.Text,\r\n                    date : parseInt(item.Datum)\r\n                };\r\n                mappedItems.push(mappedItem);\r\n            });\r\n            return mappedItems || [];\r\n        };\r\n        return service;\r\n    }]);\n\r\nangular.module('app')\r\n    .factory('orders', [\"$q\", \"$http\", \"localStorageService\", \"$log\", function ($q, $http, localStorageService, $log) {\r\n        var service = {};\r\n\r\n        service.addOrder = function (input) {\r\n            var q = $q.defer();\r\n            var data = {\r\n                ID: '0',\r\n                idUser: input.userId.toString(),\r\n                Datum: input.date.toString(),\r\n                Preis: input.totalPrice.toString(),\r\n                Bestellungsartikel: mapCartItems(input.items)\r\n            };\r\n            $http.post(\"http://localhost:8080/rest/order/add\", data)\r\n                .then(function(response) {\r\n                    if (response.data == \"Bestellung konnte nicht hinzugefügt werden\") {\r\n                        $log.error(\"error adding order\");\r\n                        q.reject(response.data);\r\n                    } else {\r\n                        $log.info(\"order added\");\r\n                        q.resolve(response.data);\r\n                    }\r\n                }, function (error) {\r\n                    $log.error(\"error adding order: \", error);\r\n                    q.reject(error.statusText);\r\n                });\r\n            return q.promise;\r\n        };\r\n\r\n        service.getOrders = function (id) {\r\n            var q = $q.defer();\r\n            $http.get(\"http://localhost:8080/rest/order/get/\" + id)\r\n                .then(function (response) {\r\n                    if(response.data == \"Bestellungen konnten nicht geladen werden\") {\r\n                        $log.error(\"error loading orders\");\r\n                        q.reject(response.data);\r\n                    } else {\r\n                        var orders = _mapOrders(response.data);\r\n                        $log.info(\"orders loaded\");\r\n                        q.resolve(orders);\r\n                    }\r\n                }, function (error) {\r\n                    $log.error(\"error loading orders: \", error);\r\n                    q.reject(error.statusText);\r\n                });\r\n\r\n            return q.promise;\r\n        };\r\n\r\n        function _mapOrders(input) {\r\n            var mapped = [];\r\n            angular.forEach(input, function (order) {\r\n                var mappedOrder = {};\r\n                mappedOrder = {\r\n                    id: parseInt(order.ID),\r\n                    userId: parseInt(order.idUser),\r\n                    date: parseInt(order.Datum),\r\n                    totalPrice: parseFloat(order.Preis),\r\n                    articles: _mapArticles(order.Bestellungsartikel)\r\n                };\r\n                mapped.push(mappedOrder);\r\n            });\r\n            return mapped;\r\n        }\r\n\r\n        function _mapArticles(input) {\r\n            var mapped = [];\r\n            angular.forEach(input, function (item) {\r\n                var mappedItem = {};\r\n                mappedItem = {\r\n                    id: parseInt(item.idArticle),\r\n                    quantity: parseInt(item.Anzahl),\r\n                    price: parseFloat(item.Preis),\r\n                    name: item.Name\r\n                };\r\n                mapped.push(mappedItem);\r\n            });\r\n            return mapped;\r\n        }\r\n\r\n        function mapCartItems(input) {\r\n            var articles = localStorageService.get(\"articles\") || {};\r\n            var mapped = [];\r\n            angular.forEach(input, function (item) {\r\n                var mappedItem = {};\r\n                if (articles[item.itemId]) {\r\n                    mappedItem = {\r\n                        idArticle : item.itemId.toString(),\r\n                        Name: articles[item.itemId].name,\r\n                        Anzahl : item.quantity.toString(),\r\n                        idOrder : '0',\r\n                        Preis : articles[item.itemId].price.toString()\r\n                    };\r\n                    mapped.push(mappedItem);\r\n                }\r\n            });\r\n            return mapped;\r\n        }\r\n\r\n        return service;\r\n    }]);\n\r\nangular.module('app')\r\n    .factory('user', [\"$q\", \"$http\", \"md5\", \"$log\", function ($q, $http, md5, $log) {\r\n        var service = {};\r\n\r\n        service.addUser = function (input) {\r\n            var q = $q.defer();\r\n            var data = {\r\n                ID : '0',\r\n                Benutzername : input.userName,\r\n                Passwort : input.password,\r\n                Email : input.email,\r\n                Rolle : input.role\r\n            };\r\n            $http.post('http://localhost:8080/rest/user/add', data)\r\n                .then(function (response) {\r\n                    if (response.data == \"User konnte nicht angelegt werden\" || response.data == \"User existiert bereits\") {\r\n                        $log.error(\"error adding user: \", response.data);\r\n                        q.reject(response.data);\r\n                    } else {\r\n                        $log.info(\"user added\");\r\n                        q.resolve(response.data);\r\n                    }\r\n                }, function (error) {\r\n                    $log.error(\"error adding user: \", error);\r\n                    q.reject(error.statusText);\r\n                });\r\n            return q.promise;\r\n        };\r\n\r\n        service.login = function (input) {\r\n            var q = $q.defer();\r\n            $http.get('http://localhost:8080/rest/user/get/' + input.userName)\r\n                .then(function (response) {\r\n                    if (response.data == \"User konnten nicht geladen werden\") {\r\n                        $log.error(\"login failed - backend or database problem\");\r\n                        q.reject(response.data);\r\n                    } else if (response.data.Benutzername == \"null\") {\r\n                        $log.warn(\"login failed - username not correct\");\r\n                        q.reject(\"Benutzer existiert nicht!\")\r\n                    } else if (response.data.Passwort === input.password) {\r\n                        $log.info(\"user logged in\");\r\n                        // encrypt password with md5 to save it to localstorage later\r\n                        q.resolve({role : response.data.Rolle, id : response.data.ID, password : md5.createHash(response.data.Passwort)});\r\n                    } else {\r\n                        $log.warn(\"login failed - password is wrong\");\r\n                        q.reject(\"Passwort falsch!\");\r\n                    }\r\n                }, function (error) {\r\n                    $log.error(\"login failed: \", error);\r\n                    q.reject(error.statusText);\r\n                });\r\n\r\n            return q.promise;\r\n        };\r\n\r\n        service.getAllUsers = function () {\r\n            var q = $q.defer();\r\n\r\n            $http.get(\"http://localhost:8080/rest/users/get\")\r\n                .then(function (response) {\r\n                    if (typeof response.data == 'string') {\r\n                        $log.error(\"error getting all users: \", response.data);\r\n                        q.reject(response.data);\r\n                    } else {\r\n                        $log.info(\"users loaded\");\r\n                        var users = _mapUsers(response.data);\r\n                        q.resolve(users);\r\n                    }\r\n                }, function (error) {\r\n                    $log.error(\"error getting all users: \", error);\r\n                    q.reject(error);\r\n                });\r\n\r\n            return q.promise;\r\n        };\r\n\r\n\r\n        // send username and get user information to verify the identity of the user\r\n        // localstorage values can be edited by a user so he can pretend that he is an admin or another user\r\n        // the authentication prevents that users can access protected sites by changing the role in the localstorage or typing in another user name\r\n\r\n        service.authenticate = function (userName, md5Password) {\r\n            var q = $q.defer();\r\n            $http.get('http://localhost:8080/rest/user/get/' + userName)\r\n                .then(function (response) {\r\n                    if (response.data == \"User konnten nicht geladen werden\") {\r\n                        $log.error(\"authentication failed - backend or database problem\");\r\n                        q.reject(response.data);\r\n                    } else if (response.data.Benutzername == \"null\") {\r\n                        $log.warn(\"authentication failed - user does not exist\");\r\n                        q.reject(\"Benutzer existiert nicht!\");\r\n                    // check if encrypted password from localstorage matches with the password from backend\r\n                    } else if (md5.createHash(response.data.Passwort) === md5Password){\r\n                        $log.info(\"authentication was successful\");\r\n                        q.resolve({role : response.data.Rolle, id : parseInt(response.data.ID), userName : userName, password: md5Password});\r\n                    } else {\r\n                        $log.warn(\"authentication failed - password wrong\");\r\n                        q.reject(\"Authentifizierung fehlgeschlagen\");\r\n                    }\r\n                }, function (error) {\r\n                    $log.warn(\"authentication failed: \", error);\r\n                    q.reject(error.statusText);\r\n                });\r\n\r\n            return q.promise;\r\n        };\r\n\r\n        service.deleteUser = function (userName) {\r\n            var q = $q.defer();\r\n\r\n            $http.get(\"http://localhost:8080/rest/user/delete/\" + userName)\r\n                .then(function (response) {\r\n                    if (response.data == \"User existiert nicht\" || response.data == \"Hat nicht funktioniert\") {\r\n                        $log.error(\"error deleting user: \", response.data);\r\n                        q.reject(response.data);\r\n                    } else {\r\n                        $log.info(\"user deleted\");\r\n                        q.resolve(response.data);\r\n                    }\r\n                }, function (error) {\r\n                    $log.error(\"error deleting user: \", error);\r\n                    if (error.statusText){\r\n                        q.reject(error.statusText);\r\n                    } else {\r\n                        q.reject();\r\n                    }\r\n                });\r\n\r\n            return q.promise;\r\n        };\r\n\r\n        function _mapUsers(input) {\r\n            var mapped = [];\r\n\r\n            angular.forEach(input, function (user) {\r\n                var mappedItem = {};\r\n                mappedItem = {\r\n                    id : parseInt(user.ID),\r\n                    userName : user.Benutzername,\r\n                    email : user.Email,\r\n                    role : user.Rolle\r\n                };\r\n                mapped.push(mappedItem);\r\n            });\r\n            return mapped;\r\n        }\r\n\r\n        return service;\r\n    }]);\n\r\nangular.module('app.topGames', [])\r\n\r\n    .config([\"$stateProvider\", function ($stateProvider) {\r\n        $stateProvider.state('topGames', {\r\n            url: '/topGames',\r\n            templateUrl: 'app/topGames/topGames.html',\r\n            controller: 'TopGamesCtrl'\r\n        });\r\n    }])\r\n\r\n    .controller('TopGamesCtrl', [\"$scope\", \"articles\", \"localStorageService\", function ($scope, articles, localStorageService) {\r\n        $scope.topGameIds = localStorageService.get(\"top-games\") || [];\r\n        $scope.articles = localStorageService.get(\"articles\") || {};\r\n        articles.getTopGames()\r\n            .then(function () {\r\n                $scope.topGameIds = localStorageService.get(\"top-games\")\r\n            }, function (error) {\r\n                toastr.error(error);\r\n            });\r\n        articles.getAllArticles()\r\n            .then(function () {\r\n                $scope.articles = localStorageService.get(\"articles\");\r\n            }, function (error) {\r\n                toastr.error(error);\r\n            });\r\n    }]);\n\r\nangular.module('app.cart', [])\r\n\r\n    .config([\"$stateProvider\", function ($stateProvider) {\r\n        $stateProvider.state('cart', {\r\n            url: '/cart',\r\n            templateUrl: 'app/cart/cart.html',\r\n            controller: 'CartCtrl'\r\n        });\r\n    }])\r\n\r\n    .controller('CartCtrl', [\"localStorageService\", \"$scope\", \"$rootScope\", function (localStorageService, $scope, $rootScope) {\r\n        $scope.cart = localStorageService.get('cart');\r\n        $scope.articles = localStorageService.get('articles');\r\n        $scope.isInvalid = false;\r\n\r\n        $scope.updateTotalPrice = function () {\r\n            $scope.totalPrice = 0;\r\n            angular.forEach($scope.cart, function (item) {\r\n                $scope.totalPrice += item.quantity * $scope.articles[item.itemId].price;\r\n            });\r\n        };\r\n        $scope.updateTotalPrice();\r\n\r\n        $scope.isInt = function (n) {\r\n            n = parseInt(n);\r\n            return Number(n) === n && n % 1 === 0;\r\n        };\r\n\r\n        $scope.quantityChange = function (id) {\r\n            var newQuantity = parseInt($scope.cart[id].quantity);\r\n            if (newQuantity < 1 || newQuantity > 20 || !$scope.isInt(newQuantity)) {\r\n                $scope.isInvalid = true;\r\n            } else {\r\n                $scope.isInvalid = false;\r\n                $scope.cart[id].quantity = newQuantity;\r\n                $scope.updateTotalPrice();\r\n                localStorageService.set('cart', $scope.cart);\r\n                $rootScope.$emit('itemAddedToCart');\r\n            }\r\n        };\r\n\r\n        $scope.remove = function (id) {\r\n            delete $scope.cart[id];\r\n            $scope.updateTotalPrice();\r\n            localStorageService.set('cart', $scope.cart);\r\n            $rootScope.$emit('itemAddedToCart');\r\n        }\r\n    }]);\n\r\nangular.module('app.userAdministration', [])\r\n\r\n    .config([\"$stateProvider\", function ($stateProvider) {\r\n        $stateProvider.state('userAdministration', {\r\n            url : '/userAdministration',\r\n            templateUrl : 'app/userAdministration/userAdministration.html',\r\n            controller : 'UserAdministrationCtrl'\r\n        });\r\n    }])\r\n\r\n    .controller('UserAdministrationCtrl', [\"$scope\", \"user\", \"localStorageService\", \"$state\", \"$rootScope\", function ($scope, user, localStorageService, $state, $rootScope) {\r\n        var currentUser = localStorageService.get(\"user\") || {};\r\n        if (angular.equals({}, currentUser)) {\r\n            toastr.info(\"Sie müssen sich einloggen, um diese Seite zu sehen\");\r\n            $state.go(\"login\");\r\n        } else {\r\n            user.authenticate(currentUser.userName, currentUser.password)\r\n                .then(function (response) {\r\n                    localStorageService.set(\"user\", response);\r\n                    currentUser = response;\r\n                    if (currentUser.role != \"admin\") {\r\n                        toastr.info(\"Diese Seite ist geschützt!\");\r\n                        $state.go(\"home\");\r\n                    } else {\r\n                        loadUsers();\r\n                    }\r\n                }, function () {\r\n                    toastr.error(\"Fehler bei der Authentifizierung\");\r\n                    toastr.warning(\"Sie werden nun automatisch ausgeloggt\");\r\n                    $rootScope.logout();\r\n                });\r\n        }\r\n\r\n        function loadUsers() {\r\n            user.getAllUsers()\r\n                .then(function (response) {\r\n                    $scope.users = response;\r\n                }, function (error) {\r\n                    if (error) {\r\n                        toastr.error(error);\r\n                    } else {\r\n                        toastr.error(\"Ein unbekannter Fehler ist aufgetreten!\");\r\n                    }\r\n                });\r\n        }\r\n\r\n        $scope.deleteUser = function (userName) {\r\n            var confirm = window.confirm(\"Wollen Sie den Benutzer \" + userName + \" wirklich löschen?\");\r\n            if (confirm) {\r\n                user.deleteUser(userName)\r\n                    .then(function (response) {\r\n                        toastr.success(response);\r\n                        loadUsers();\r\n                    }, function (error) {\r\n                        toastr.error(error);\r\n                    });\r\n            }\r\n        }\r\n    }]);\n\r\nangular.module('app.gameDetail', [])\r\n\r\n    .config([\"$stateProvider\", function ($stateProvider) {\r\n        $stateProvider.state('gameDetail', {\r\n            url : '/gameDetail/:id',\r\n            templateUrl : 'app/gameDetail/gameDetail.html',\r\n            controller : 'GameDetailCtrl'\r\n        });\r\n    }])\r\n\r\n    .controller('GameDetailCtrl', [\"$scope\", \"$http\", \"$stateParams\", \"localStorageService\", \"$uibModal\", \"$state\", \"articles\", \"$rootScope\", \"$log\", function ($scope, $http, $stateParams, localStorageService, $uibModal, $state, articles, $rootScope, $log) {\r\n        $scope.tab = {};\r\n        $scope.tab.active = 'description';\r\n\r\n        $scope.quantity = 1;\r\n\r\n        $scope.isValidQuantity = true;\r\n        $scope.calcPrice = function () {\r\n            var price = $scope.actualGame.price * $scope.quantity;\r\n            if (isNaN(price) || $scope.quantity < 1 || $scope.quantity > 20) {\r\n                //&#8209; : minus without line break\r\n                $scope.price = \"Bitte gültige Anzahl (1&#8209;20) angeben!\";\r\n                $scope.isValidQuantity = false;\r\n            } else {\r\n                $scope.price = Math.round(price * 100) / 100;\r\n                $scope.isValidQuantity = true;\r\n            }\r\n        };\r\n\r\n        // load game at initial start\r\n        loadGame();\r\n\r\n        function loadGame() {\r\n            // get the id from the url parameters\r\n            var id = $stateParams.id;\r\n            $scope.articles = localStorageService.get('articles');\r\n            $scope.actualGame = $scope.articles[id];\r\n            if (!$scope.actualGame) {\r\n                toastr.warning('Das Spiel mit der ID ' + id + ' existiert nicht!');\r\n                $state.go('home');\r\n            } else {\r\n                $scope.stars = calculateAverageStars($scope.actualGame.reviews);\r\n                document.getElementById(\"description\").innerHTML = $scope.actualGame.description;\r\n                $scope.calcPrice();\r\n            }\r\n        }\r\n\r\n        $rootScope.$on(\"articles-loaded\", function () {\r\n            // not every time the event is fired, the game detail site is opened\r\n            // only react to the event when the site is opened\r\n            if ($state.current.name == \"gameDetail\") {\r\n                loadGame();\r\n            }\r\n        });\r\n\r\n        var user = localStorageService.get('user') || {};\r\n        var userName = user.userName;\r\n\r\n        function calculateAverageStars(data) {\r\n            var count = 0;\r\n            var stars = 0;\r\n            angular.forEach(data, function (item) {\r\n                count++;\r\n                stars += item.stars;\r\n            });\r\n            $scope.reviewsCount = count;\r\n            if (count === 0) {\r\n                return 0;\r\n            } else {\r\n                return stars / count;\r\n            }\r\n        }\r\n\r\n        $scope.changeTab = function (type) {\r\n            $scope.tab.active = type;\r\n        };\r\n\r\n        $scope.toCart = function () {\r\n            if ($scope.quantity >= 1) {\r\n                var cart = localStorageService.get('cart') || {};\r\n                // merge item quantity with cart quantity\r\n                if (cart[$scope.actualGame.id] && cart[$scope.actualGame.id].quantity) {\r\n                    cart[$scope.actualGame.id].quantity = parseInt(cart[$scope.actualGame.id].quantity) + parseInt($scope.quantity)\r\n                } else {\r\n                    cart[$scope.actualGame.id] = {\r\n                        itemId : $scope.actualGame.id,\r\n                        quantity : parseInt($scope.quantity)\r\n                    };\r\n                }\r\n                localStorageService.set('cart', cart);\r\n                $rootScope.$emit('itemAddedToCart');\r\n                toastr.success('<img src=\"assets/img/giphy.gif\" ng-show=\"inCart\"/>');\r\n                toastr.success('Artikel erfolgreich ' + $scope.quantity + 'x in den Warenkorb gelegt!');\r\n            } else {\r\n                toastr.warning('Bitte geben Sie eine gültige Zahl ein!')\r\n            }\r\n        };\r\n\r\n        // logic for rating\r\n        $scope.starsActivator = {};\r\n        $scope.numbers = [1, 2, 3, 4, 5];\r\n        for (var i = 0; i <= 4; i++) {\r\n            $scope.starsActivator[$scope.numbers[i]] = false;\r\n        }\r\n        $scope.starHover = function (number) {\r\n            while (number > 0) {\r\n                $scope.starsActivator[number] = true;\r\n                number--;\r\n            }\r\n        };\r\n        $scope.leave = function () {\r\n            for (var i = 0; i <= 4; i++) {\r\n                $scope.starsActivator[$scope.numbers[i]] = false;\r\n            }\r\n        };\r\n        $scope.rate = function (stars) {\r\n            if (userName) {\r\n                var newReviewId = 1;\r\n                do {\r\n                    newReviewId++;\r\n                } while ($scope.actualGame.reviews[newReviewId]);\r\n                var title = '';\r\n                var message = '';\r\n                angular.forEach($scope.actualGame.reviews, function (review) {\r\n                    // if user wrote a preview before\r\n                    if (review.author == user.userName) {\r\n                        title = review.title;\r\n                        message = review.message;\r\n                        newReviewId = review.id;\r\n                    }\r\n                });\r\n                // modal\r\n                var modalInstance = $uibModal.open({\r\n                    animation : true,\r\n                    templateUrl : 'app/gameDetail/rating/rating.html',\r\n                    controller : 'RatingCtrl',\r\n                    // send data from previous review to modal controller\r\n                    resolve : {\r\n                        stars : function () {\r\n                            return stars;\r\n                        },\r\n                        title : function () {\r\n                            return title;\r\n                        },\r\n                        message : function () {\r\n                            return message;\r\n                        }\r\n                    }\r\n                });\r\n                // code when modal is closed\r\n                modalInstance.result.then(function (result) {\r\n                    // modal has been closed because user wants to send a review\r\n                    var data = {\r\n                        id : 0,\r\n                        stars : result.stars,\r\n                        title : result.title,\r\n                        message : result.message,\r\n                        author : userName,\r\n                        articleId : $scope.actualGame.id\r\n                    };\r\n                    articles.addReview(data)\r\n                        .then(function () {\r\n                            toastr.success('Bewertung hinzugefügt!');\r\n                        }, function (error) {\r\n                            toastr.error(\"Bewertung wurde nicht hinzugefügt!\");\r\n                            if (error) {\r\n                                toastr.error(error);\r\n                            } else {\r\n                                toastr.error(\"Ein unbekannter Fehler ist aufgetreten!\");\r\n                            }\r\n                        });\r\n                }, function () {\r\n                    // modal has been closed because user pressed the cancel button\r\n                    $log.info('Modal dismissed');\r\n                });\r\n            } else {\r\n                toastr.warning('Bitte loggen Sie sich zuerst ein!');\r\n            }\r\n        };\r\n    }]);\n\r\nangular.module('app.checkout', [])\r\n\r\n    .config([\"$stateProvider\", function ($stateProvider) {\r\n        $stateProvider.state('checkout', {\r\n            url : '/checkout',\r\n            templateUrl : 'app/cart/checkout/checkout.html',\r\n            controller : 'CheckoutCtrl'\r\n        });\r\n    }])\r\n\r\n    .controller('CheckoutCtrl', [\"$scope\", \"localStorageService\", \"$state\", \"orders\", \"$rootScope\", function ($scope, localStorageService, $state, orders, $rootScope) {\r\n        $scope.isLoading = false;\r\n\r\n        var user = localStorageService.get('user') || {};\r\n        if (!user.userName) {\r\n            // if user wants to order something but isn't logged in, he will be directed to the checkout after login\r\n            localStorageService.set('fromCheckout', true);\r\n            toastr.info('Bitte melden Sie sich an.');\r\n            $state.go('login');\r\n        }\r\n        $scope.cart = localStorageService.get('cart') || {};\r\n\r\n        // if nothing in cart, no checkout\r\n        if (angular.equals({}, $scope.cart)) {\r\n            $state.go(\"home\");\r\n        }\r\n\r\n        $scope.articles = localStorageService.get('articles') || {};\r\n\r\n        $scope.updateTotalPrice = function () {\r\n            $scope.totalPrice = 0;\r\n            angular.forEach($scope.cart, function (item) {\r\n                $scope.totalPrice += item.quantity * $scope.articles[item.itemId].price;\r\n            });\r\n        };\r\n\r\n        // if game is fsk 16 or 18, user has to confirm age\r\n        $scope.highestFsk = 0;\r\n        $scope.isAgeConfirmed = false;\r\n        angular.forEach($scope.cart, function (item) {\r\n             if ($scope.articles[item.itemId].fsk > $scope.highestFsk) {\r\n                 $scope.highestFsk = $scope.articles[item.itemId].fsk;\r\n             }\r\n        });\r\n\r\n        $scope.ageConfirmedChange = function () {\r\n            $scope.isAgeConfirmed ? $scope.isAgeConfirmed = false : $scope.isAgeConfirmed = true;\r\n        };\r\n\r\n        $scope.addOrder = function () {\r\n            $scope.isLoading = true;\r\n            var cart = localStorageService.get(\"cart\");\r\n            var data = {\r\n                userId : user.id,\r\n                date : new Date().getTime(),\r\n                totalPrice : $scope.totalPrice,\r\n                items : cart\r\n            };\r\n            orders.addOrder(data)\r\n                .then(function (response) {\r\n                    $scope.isLoading = false;\r\n                    toastr.success(response);\r\n                    localStorageService.remove(\"cart\");\r\n                    // update cart elements count\r\n                    $rootScope.$emit(\"itemAddedToCart\");\r\n                    $state.go(\"orders\");\r\n                }, function (error) {\r\n                    $scope.isLoading = false;\r\n                    if (!error) {\r\n                        toastr.error(\"Ein unbekannter Fehler ist aufgetreten!\");\r\n                    } else {\r\n                        toastr.error(error);\r\n                    }\r\n                });\r\n        };\r\n        $scope.updateTotalPrice();\r\n\r\n    }]);\n\r\nangular.module('app.gameDetail')\r\n    .controller('RatingCtrl', [\"$scope\", \"$uibModalInstance\", \"stars\", \"title\", \"message\", function ($scope, $uibModalInstance, stars, title, message) {\r\n        \r\n        $scope.stars = stars;\r\n        $scope.message = message;\r\n        $scope.title = title;\r\n        title ? $scope.isNewReview = false: $scope.isNewReview = true;\r\n\r\n        $scope.isTitleTouched = false;\r\n        $scope.isMessageTouched = false;\r\n        $scope.titleRegex = /^.{4,100}$/;\r\n        $scope.messageRegex = /^.{4,1000}$/;\r\n\r\n        // check if inputs are empty\r\n        $scope.checkValid = function () {\r\n            $scope.message && $scope.title && $scope.titleRegex.test($scope.title) && $scope.messageRegex.test($scope.message) ? $scope.isValid = true : $scope.isValid = false;\r\n        };\r\n        $scope.checkValid();\r\n\r\n        $scope.submit = function () {\r\n            var result = {\r\n                title: $scope.title,\r\n                message: $scope.message,\r\n                stars: $scope.stars\r\n            };\r\n            $uibModalInstance.close(result);\r\n        };\r\n        $scope.cancel = function () {\r\n            $uibModalInstance.dismiss();\r\n        };\r\n    }]);\n\r\nangular.module('app.register', [])\r\n\r\n    .config([\"$stateProvider\", function ($stateProvider) {\r\n        $stateProvider.state('register', {\r\n            url: '/register',\r\n            templateUrl: 'app/login/register/register.html',\r\n            controller: 'RegisterCtrl'\r\n        });\r\n    }])\r\n\r\n    .controller('RegisterCtrl', [\"$scope\", \"user\", \"$state\", function ($scope, user, $state) {\r\n        $scope.data = {};\r\n        $scope.data.userName = '';\r\n        $scope.data.email = '';\r\n        $scope.data.password = '';\r\n        $scope.data.passwordConfirm = '';\r\n        $scope.isTouched = false;\r\n        $scope.isLoading = false;\r\n\r\n        // regex\r\n        $scope.pattern = /^(([^<>()\\[\\]\\\\.,;:\\s@\"]+(\\.[^<>()\\[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\r\n        $scope.userRegex = /^[a-zA-Z0-9äöüÄÖÜ._-]{4,20}$/;\r\n        $scope.passwordRegex = /^[a-zA-Z0-9äöüÄÖÜ._-]{6,20}$/;\r\n\r\n        //Trigger Login when enter pressed\r\n        $(\"#form\").keydown(function (event) {\r\n            if (event.keyCode == 13) {\r\n                $(\"#submit\").click();\r\n            }\r\n        });\r\n\r\n        $scope.register = function () {\r\n            $scope.isTouched = true;\r\n            if (!$scope.data.userName || !$scope.data.password || !$scope.data.passwordConfirm) {\r\n                toastr.warning('Alle Felder müssen ausgefüllt werden!', 'Fehlende Informationen!');\r\n            } else if (!$scope.userRegex.test($scope.data.userName)) {\r\n                toastr.warning(\"Der Benutzername darf nur bestimmte Sonderzeichen enthalten und muss zwischen 4 und 20 Zeichen lang sein!\")\r\n            } else if (!$scope.data.email || !$scope.pattern.test($scope.data.email) || $scope.data.email > 60) {\r\n                toastr.warning('Die Email-Adresse ist ungültig!', 'Fehlerhafte Informationen!');\r\n            } else if ($scope.data.password != $scope.data.passwordConfirm) {\r\n                toastr.warning('Die Passwörter stimmen nicht überein.', 'Fehlerhafte Informationen!');\r\n            } else if (!$scope.passwordRegex.test($scope.data.password)) {\r\n                toastr.warning('Passwort zu kurz!');\r\n            } else {\r\n                $scope.isLoading = true;\r\n                var data = {\r\n                    userName: $scope.data.userName,\r\n                    password: $scope.data.password,\r\n                    email: $scope.data.email,\r\n                    role: 'user'\r\n                };\r\n                user.addUser(data)\r\n                    .then(function() {\r\n                        $scope.isLoading = false;\r\n                        toastr.success(\"Der Benutzer wurde erfolgreich angelegt!\");\r\n                        $state.go('login');\r\n                        toastr.info(\"Bitte loggen Sie sich mit den neuen Daten an.\");\r\n                    }, function (error) {\r\n                        $scope.isLoading = false;\r\n                        if (error) {\r\n                            toastr.error(error);\r\n                        } else {\r\n                            toastr.error(\"Fehler bei der Verbindung zum Server!\");\r\n                        }\r\n                    });\r\n            }\r\n        }\r\n    }]);\n\n})(window, document);\n"],"sourceRoot":"/source/"}
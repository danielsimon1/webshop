!function(e,t,r){"use strict";angular.module("app",["ui.router","ui.bootstrap","LocalStorageModule","ngAnimate","templates","textAngular","angular-md5","angular-loading-bar","app.home","app.addArticle","app.topGames","app.newGames","app.gameDetail","app.login","app.genre","app.cart","app.checkout","app.orders","app.userAdministration","app.register"]).config(["$urlRouterProvider","localStorageServiceProvider","cfpLoadingBarProvider",function(e,t,r){e.otherwise("/home"),t.setPrefix("webshop"),r.includeSpinner=!1,toastr.options={closeButton:!1,debug:!1,newestOnTop:!1,progressBar:!1,positionClass:"toast-bottom-right",preventDuplicates:!1,onclick:null,showDuration:"300",hideDuration:"1000",timeOut:"5000",extendedTimeOut:"1000",showEasing:"swing",hideEasing:"linear",showMethod:"fadeIn",hideMethod:"fadeOut"}}]).run(["localStorageService","articles","$rootScope","$log",function(e,t,r,a){t.getAllArticles().then(function(t){r.$emit("genresLoaded"),e.set("articles",t)},function(t){var r=e.get("articles");r?toastr.error("Artikel konnten nicht neu geladen werden. Daten wurden aus dem Cache geladen."):toastr.error("Artikel konnten nicht geladen werden."),a.error(t)}),e.set("fromCheckout",!1)}]).controller("AppCtrl",["$scope","$rootScope","$http","localStorageService","$state","articles",function(e,t,r,a,n,i){a.remove("checkout"),t.$on("$stateChangeSuccess",function(t,r,a){e.currentStateName=r.name,e.currentStateParams=a.name}),t.$on("itemAddedToCart",function(){s()}),t.$on("login",function(){o()}),e.genres=a.get("genres"),t.$on("articles-loaded",function(){e.genres=a.get("genres")}),t.logout=function(){a.remove("user"),a.remove("orders"),a.remove("checkout"),t.$emit("login"),t.$emit("itemAddedToCart"),toastr.success("Logout war erfolgreich."),n.go("login")};var o=function(){var t=a.get("user")||{};e.userName=t.userName||"Benutzer",e.userRole=t.role};o();var s=function(){var t=a.get("cart");e.quantity=0;var r=a.get("articles")||{};angular.forEach(t,function(a){r[a.itemId]?e.quantity+=a.quantity:delete t[a.itemId]}),a.set("cart",t)};s()}]).filter("objectFilter",function(){return function(e,t){var r=[];return t=t?t.toLowerCase():"",angular.forEach(e,function(e,a){-1!==e.name.toLowerCase().indexOf(t)&&r.push(e)}),r}}),angular.module("app.cart",[]).config(["$stateProvider",function(e){e.state("cart",{url:"/cart",templateUrl:"app/cart/cart.html",controller:"CartCtrl"})}]).controller("CartCtrl",["localStorageService","$scope","$rootScope",function(e,t,r){t.cart=e.get("cart"),t.articles=e.get("articles"),t.isInvalid=!1,t.updateTotalPrice=function(){t.totalPrice=0,angular.forEach(t.cart,function(e){t.totalPrice+=e.quantity*t.articles[e.itemId].price})},t.updateTotalPrice(),t.isInt=function(e){return e=parseInt(e),Number(e)===e&&e%1===0},t.quantityChange=function(a){var n=parseInt(t.cart[a].quantity);1>n||n>20||!t.isInt(n)?t.isInvalid=!0:(t.isInvalid=!1,t.cart[a].quantity=n,t.updateTotalPrice(),e.set("cart",t.cart),r.$emit("itemAddedToCart"))},t.remove=function(a){delete t.cart[a],t.updateTotalPrice(),e.set("cart",t.cart),r.$emit("itemAddedToCart")}}]),angular.module("app.genre",[]).config(["$stateProvider",function(e){e.state("genre",{url:"/genre/:name",templateUrl:"app/genre/genre.html",controller:"GenreCtrl"})}]).controller("GenreCtrl",["$stateParams","localStorageService","$scope",function(e,t,r){r.searchInput="",r.isAllGenres=!1,r.genre=e.name;var a=t.get("articles");r.articles={},r.isArticles=!1,"Alle Spiele"!=r.genre?angular.forEach(a,function(e){e.genre==r.genre&&(r.isArticles=!0,r.articles[e.id]=e)}):(r.isArticles=!0,r.isAllGenres=!0,r.articles=a)}]),angular.module("app.gameDetail",[]).config(["$stateProvider",function(e){e.state("gameDetail",{url:"/gameDetail/:id",templateUrl:"app/gameDetail/gameDetail.html",controller:"GameDetailCtrl"})}]).controller("GameDetailCtrl",["$scope","$http","$stateParams","localStorageService","$uibModal","$state","articles","$rootScope",function(e,r,a,n,i,o,s,l){function c(){var r=a.id;e.articles=n.get("articles"),e.actualGame=e.articles[r],e.actualGame?(e.stars=u(e.actualGame.reviews),t.getElementById("description").innerHTML=e.actualGame.description,e.calcPrice()):(toastr.warning("Das Spiel mit der ID "+r+" existiert nicht!"),o.go("home"))}function u(t){var r=0,a=0;return angular.forEach(t,function(e){r++,a+=e.stars}),e.reviewsCount=r,0===r?0:a/r}e.tab={},e.tab.active="description",e.quantity=1,e.isValidQuantity=!0,e.calcPrice=function(){var t=e.actualGame.price*e.quantity;isNaN(t)||e.quantity<1||e.quantity>20?(e.price="Bitte gültige Anzahl (1&#8209;20) angeben!",e.isValidQuantity=!1):(e.price=Math.round(100*t)/100,e.isValidQuantity=!0)},c(),l.$on("articles-loaded",function(){"gameDetail"==o.current.name&&c()});var d=n.get("user")||{},g=d.userName;e.changeTab=function(t){e.tab.active=t},e.toCart=function(){if(e.quantity>=1){var t=n.get("cart")||{};t[e.actualGame.id]&&t[e.actualGame.id].quantity?t[e.actualGame.id].quantity=parseInt(t[e.actualGame.id].quantity)+parseInt(e.quantity):t[e.actualGame.id]={itemId:e.actualGame.id,quantity:parseInt(e.quantity)},n.set("cart",t),l.$emit("itemAddedToCart"),toastr.success('<img src="assets/img/giphy.gif" ng-show="inCart"/>'),toastr.success("Artikel erfolgreich "+e.quantity+"x in den Warenkorb gelegt!")}else toastr.warning("Bitte geben Sie eine gültige Zahl ein!")},e.starsActivator={},e.numbers=[1,2,3,4,5];for(var m=0;4>=m;m++)e.starsActivator[e.numbers[m]]=!1;e.starHover=function(t){for(;t>0;)e.starsActivator[t]=!0,t--},e.leave=function(){for(var t=0;4>=t;t++)e.starsActivator[e.numbers[t]]=!1},e.rate=function(t){if(g){var r=1;do r++;while(e.actualGame.reviews[r]);var a="",n="";angular.forEach(e.actualGame.reviews,function(e){e.author==d.userName&&(a=e.title,n=e.message,r=e.id)});var o=i.open({animation:!0,templateUrl:"app/gameDetail/rating/rating.html",controller:"RatingCtrl",resolve:{stars:function(){return t},title:function(){return a},message:function(){return n}}});o.result.then(function(t){var r={id:0,stars:t.stars,title:t.title,message:t.message,author:g,articleId:e.actualGame.id};s.addReview(r).then(function(){toastr.success("Bewertung hinzugefügt!")},function(e){toastr.error("Bewertung wurde nicht hinzugefügt!"),e?toastr.error(e):toastr.error("Ein unbekannter Fehler ist aufgetreten!")})},function(){console.log("Modal dismissed")})}else toastr.warning("Bitte loggen Sie sich zuerst ein!")}}]),angular.module("app.addArticle",[]).config(["$stateProvider",function(e){e.state("addArticle",{url:"/addArticle",templateUrl:"app/addArticle/addArticle.html",controller:"AddArticleCtrl"})}]).controller("AddArticleCtrl",["$scope","articles","$log","$state","localStorageService","user","$rootScope",function(e,t,r,a,n,i,o){function s(){var t=[];return angular.forEach(e.selected.platform,function(e,r){e&&t.push(r)}),t}function l(e){return/(?=.)^\$?(([1-9][0-9]{0,2}(,[0-9]{3})*)|[0-9]+)?(\.[0-9]{1,2})?$/.test(e)}var c=n.get("user")||{};angular.equals({},c)?(toastr.info("Sie müssen sich einloggen, um diese Seite zu sehen"),a.go("login")):i.authenticate(c.userName,c.password).then(function(e){n.set("user",e),c=e,"admin"!=c.role&&(toastr.info("Diese Seite ist geschützt!"),a.go("home"))},function(){toastr.error("Fehler bei der Authentifizierung"),toastr.warning("Sie werden nun automatisch ausgeloggt"),o.logout()}),e.selected={},e.selected.platform={},e.selected.fsk="0",e.isTouched=!1,e.isPriceInvalid=!1,e.isPriceTouched=!1,e.isCustomGenre=!1,e.genreButtonText="Neues Genre anlegen",e.isLoading=!1,e.genres=n.get("genres")||[],t.getAllArticles().then(function(){e.genres=n.get("genres")||[]},function(e){toastr.error(e)}),e.changeInputStyle=function(){e.isCustomGenre?e.isCustomGenre=!1:e.isCustomGenre=!0,"Neues Genre anlegen"==e.genreButtonText?e.genreButtonText="Vorhandenes Genre auswählen":e.genreButtonText="Neues Genre anlegen"},e.priceValidation=function(){e.isPriceTouched=!0,l(e.price)?e.isPriceInvalid=!1:e.isPriceInvalid=!0},e.imageToBase64=function(t){if(t.files&&t.files[0]){var r=new FileReader;r.onload=function(t){console.log("image successfully converted to Base64"),e.image=t.target.result,e.$apply()},r.readAsDataURL(t.files[0])}},e.isInt=function(e){return e=parseInt(e),Number(e)===e&&e%1===0},e.isFloat=function(e){return e=parseFloat(e),Number(e)===e&&e%1!==0},e.addArticle=function(){if(e.isTouched=!0,e.isPriceTouched=!0,e.isPriceInvalid=!1,e.titleRegex=/^.{4,60}$/,e.genreRegex=/^.{4,20}$/,e.languageRegex=/^.{4,15}$/,e.descriptionRegex=/^.{1,8000}$/,e.title&&(e.selected.genre&&!e.isCustomGenre||e.customGenre&&e.isCustomGenre&&genreRegex.test(e.customGenre))&&e.price&&e.descriptionRegex.test(e.description)&&(e.selected.platform.wiiu||e.selected.platform.windows||e.selected.platform.ps||e.selected.platform.xbox||e.selected.platform.osx)&&e.release&&e.language&&e.minRam&&e.languageRegex.test(e.language)&&e.minProcessor&&e.description&&e.image&&e.titleRegex.test(e.title))if(l(e.price))if(e.isInt(e.minRam))if(e.isFloat(e.minProcessor)||e.isInt(e.minProcessor)){e.isLoading=!0;var r=new Date(e.release).getTime(),n={id:2,name:e.title,genre:e.isCustomGenre?e.customGenre:e.selected.genre,price:e.price,fsk:e.selected.fsk,platforms:s(),release:r.toString(),language:e.language,minRam:e.minRam,minProcessor:e.minProcessor,description:e.description,image:e.image};t.addArticle(n).then(function(t){e.isLoading=!1,toastr.success(t),a.go("home")},function(t){e.isLoading=!1,t?toastr.error(t):toastr.error("Ein unbekannter Fehler ist aufgetreten!")})}else toastr.warning("Der Prozessor muss mit einer Zahl angegeben werden! Für Nachkommastellen den Punkt verwenden!");else toastr.warning("Der Arbeitsspeicher muss mit einer natürlichen Zahl angegeben werden!");else toastr.warning("Ungültiger Preis!"),e.isPriceInvalid=!0;else toastr.warning("Fehlende Informationen!")}}]),angular.module("app.home",[]).config(["$stateProvider",function(e){e.state("home",{url:"/home",templateUrl:"app/home/home.html",controller:"HomeCtrl"})}]).controller("HomeCtrl",function(){}),angular.module("app.login",[]).config(["$stateProvider",function(e){e.state("login",{url:"/login",templateUrl:"app/login/login.html",controller:"LoginCtrl"})}]).controller("LoginCtrl",["$scope","$state","localStorageService","$rootScope","$http","user",function(e,t,r,a,n,i){e.isFormTouched=!1,e.isLoading=!1;var o=r.get("user")||{},s=r.get("fromCheckout");o.userName&&(toastr.info('Sie sind bereits eingeloogt als "'+o.userName+'"!'),t.go("home")),e.data={},e.data.password="",e.data.userName="",$("#form").keydown(function(e){13==e.keyCode&&$("#submit").click()}),e.login=function(){if(e.isFormTouched=!0,e.data.userName&&e.data.password){e.isLoading=!0;var n={userName:e.data.userName,password:e.data.password};i.login(n).then(function(n){e.isLoading=!1,toastr.success("Login war erfolgreich.");var i={userName:e.data.userName,role:n.role,id:parseInt(n.id),password:n.password};r.set("user",i),a.$emit("login"),r.remove("fromCheckout"),s?t.go("checkout"):t.go("home")},function(t){e.isLoading=!1,t?toastr.error(t):toastr.error("Fehler bei der Verbindung zum Server!")})}else toastr.warning('<img src="assets/img/Epic_Mass_Facepalm.gif"/>'),toastr.warning("You had one Job!")}}]),angular.module("app.newGames",[]).config(["$stateProvider",function(e){e.state("newGames",{url:"/newGames",templateUrl:"app/newGames/newGames.html",controller:"NewGamesCtrl"})}]).controller("NewGamesCtrl",["$scope","articles","localStorageService",function(e,t,r){e.newGameIds=r.get("new-games")||[],e.articles=r.get("articles")||{},t.getAllArticles().then(function(){e.newGameIds=r.get("new-games"),e.articles=r.get("articles")},function(e){toastr.error(e)})}]),angular.module("app.orders",[]).config(["$stateProvider",function(e){e.state("orders",{url:"/orders",templateUrl:"app/orders/orders.html",controller:"OrdersCtrl"})}]).controller("OrdersCtrl",["$scope","$http","localStorageService","$state","orders","user","$rootScope",function(e,t,r,a,n,i,o){var s=r.get("user")||{};e.articles=r.get("articles")||{},angular.equals({},s)?(toastr.info("Sie müssen sich einloggen, um diese Seite zu sehen"),a.go("login")):i.authenticate(s.userName,s.password).then(function(t){r.set("user",t),s=t,n.getOrders(s.id).then(function(t){e.orders=t},function(e){e?toastr.error(e):toastr.error("Ein unbekannter Fehler ist aufgetreten!")})},function(){toastr.error("Fehler bei der Authentifizierung"),toastr.warning("Sie werden nun automatisch ausgeloggt"),o.logout()})}]),angular.module("app").factory("articles",["$q","$http","localStorageService","$rootScope","$log","$filter",function(e,t,r,a,n,i){function o(e){var t=[];return angular.forEach(e,function(e){t.push(e.trim())}),t}var s={};s.getAllArticles=function(){var i=e.defer();return t.get("http://localhost:8080/rest/article/get/all").then(function(e){if("string"==typeof e.data)n.error("loading articles failed: ",e.data),i.reject(e.data);else{var t=l(e.data);r.set("articles",t),a.$emit("articles-loaded"),n.info("articles loaded"),s.getNewGames(t),i.resolve(t)}},function(e){n.error("loading articles failed: ",e),i.reject(e.statusText)}),i.promise},s.addArticle=function(r){var a=e.defer(),i={ID:r.id.toString(),Name:r.name,Genre:r.genre,Preis:r.price,FSK:r.fsk,Plattformen:r.platforms,Release:r.release,Sprache:r.language,minRam:parseInt(r.minRam),minProcessor:parseFloat(r.minProcessor),Beschreibung:r.description,image:r.image,Rezensionen:[]};return t.post("http://localhost:8080/rest/article/add",i).then(function(e){"Artikel existiert bereits"==e.data?(n.error("error adding article: ",e.data),a.reject(e.data)):"Artikel konnte nicht hinzugefügt werden"==e.data?(n.error("error adding article: ",e.data),a.reject(e.data)):(n.info("adding article was successful"),s.getAllArticles(),a.resolve(e.data))},function(e){n.error("error adding article: ",e),a.reject(e.statusText)}),a.promise},s.addReview=function(r){var a=e.defer(),i=(new Date).getTime(),o={ID:"0",idArticle:r.articleId.toString(),stars:r.stars.toString(),Autor:r.author,Titel:r.title,Text:r.message,Datum:i.toString()};return t.post("http://localhost:8080/rest/review/add",o).then(function(e){"Rezension konnte nicht hinzugefügt werden"==e.data?(n.error("error adding review: ",e.data),a.reject(e.data)):(n.info("adding review was successful"),s.getAllArticles(),a.resolve(e.data))},function(e){n.error("error adding review: ",e),a.reject(e.statusText)}),a.promise},s.getTopGames=function(){var a=e.defer();return t.get("http://localhost:8080/rest/article/get/top").then(function(e){if("string"==typeof e.data)n.error("error getting top games: ",e.data),a.reject(e.data);else{var t=[];angular.forEach(e.data,function(e){t.push(parseInt(e.ID)),r.set("top-games",t)}),n.info("top games loaded"),a.resolve(t)}},function(e){n.error("error getting top games: ",e),a.reject(e.statusText)}),a.promise},s.getNewGames=function(e){var t=[];angular.forEach(e,function(e){e.release=parseInt(e.release),t.push(e)});var a=i("orderBy")(t,"release",!0),n=a.slice(0,5),o=[];angular.forEach(n,function(e){o.push(e.id)}),r.set("new-games",o)};var l=function(e){var t={},a=[];return angular.forEach(e,function(e){var r=!0;angular.forEach(a,function(t){e.Genre==t&&(r=!1)});var n={id:parseInt(e.ID),name:e.Name,genre:e.Genre,price:parseFloat(e.Preis),fsk:parseInt(e.FSK),platforms:o(e.Plattformen),release:e.Release,language:e.Sprache,minRam:e.minRam,minProcessor:e.minProcessor,image:e.image,description:e.Beschreibung,reviews:c(e.Rezensionen)};r&&a.push(n.genre),t[n.id]=n}),r.set("genres",a),t},c=function(e){var t=[];return angular.forEach(e,function(e){var r={id:parseInt(e.ID),stars:parseInt(e.stars),author:e.Autor,title:e.Titel,message:e.Text,date:parseInt(e.Datum)};t.push(r)}),t||[]};return s}]),"undefined"!=typeof module&&"undefined"!=typeof exports&&module.exports===exports&&(module.exports="angular-md5"),function(e){e.module("angular-md5",["gdi2290.md5"]),e.module("ngMd5",["gdi2290.md5"]),e.module("gdi2290.md5",["gdi2290.gravatar-filter","gdi2290.md5-service","gdi2290.md5-filter"]),e.module("gdi2290.gravatar-filter",[]).filter("gravatar",["md5",function(e){var t={};return function(r,a){return t[r]||(a=a?e.createHash(a.toString().toLowerCase()):"",t[r]=r?e.createHash(r.toString().toLowerCase()):a),t[r]}}]),e.module("gdi2290.md5-filter",[]).filter("md5",["md5",function(e){return function(t){return t?e.createHash(t.toString().toLowerCase()):t}}]),e.module("gdi2290.md5-service",[]).factory("md5",[function(){var e={createHash:function(e){if(null===e)return null;var t,r,a,n,i,o,s,l,c,u,d=function(e,t){return e<<t|e>>>32-t},g=function(e,t){var r,a,n,i,o;return n=2147483648&e,i=2147483648&t,r=1073741824&e,a=1073741824&t,o=(1073741823&e)+(1073741823&t),r&a?2147483648^o^n^i:r|a?1073741824&o?3221225472^o^n^i:1073741824^o^n^i:o^n^i},m=function(e,t,r){return e&t|~e&r},f=function(e,t,r){return e&r|t&~r},p=function(e,t,r){return e^t^r},h=function(e,t,r){return t^(e|~r)},v=function(e,t,r,a,n,i,o){return e=g(e,g(g(m(t,r,a),n),o)),g(d(e,i),t)},w=function(e,t,r,a,n,i,o){return e=g(e,g(g(f(t,r,a),n),o)),g(d(e,i),t)},$=function(e,t,r,a,n,i,o){return e=g(e,g(g(p(t,r,a),n),o)),g(d(e,i),t)},S=function(e,t,r,a,n,i,o){return e=g(e,g(g(h(t,r,a),n),o)),g(d(e,i),t)},A=function(e){for(var t,r=e.length,a=r+8,n=(a-a%64)/64,i=16*(n+1),o=new Array(i-1),s=0,l=0;r>l;)t=(l-l%4)/4,s=l%4*8,o[t]=o[t]|e.charCodeAt(l)<<s,l++;return t=(l-l%4)/4,s=l%4*8,o[t]=o[t]|128<<s,o[i-2]=r<<3,o[i-1]=r>>>29,o},I=function(e){var t,r,a="",n="";for(r=0;3>=r;r++)t=e>>>8*r&255,n="0"+t.toString(16),a+=n.substr(n.length-2,2);return a},P=[],C=7,G=12,k=17,b=22,T=5,x=9,y=14,D=20,N=4,R=11,z=16,B=23,E=6,L=10,U=15,F=21;for(P=A(e),s=1732584193,l=4023233417,c=2562383102,u=271733878,t=P.length,r=0;t>r;r+=16)a=s,n=l,i=c,o=u,s=v(s,l,c,u,P[r+0],C,3614090360),u=v(u,s,l,c,P[r+1],G,3905402710),c=v(c,u,s,l,P[r+2],k,606105819),l=v(l,c,u,s,P[r+3],b,3250441966),s=v(s,l,c,u,P[r+4],C,4118548399),u=v(u,s,l,c,P[r+5],G,1200080426),c=v(c,u,s,l,P[r+6],k,2821735955),l=v(l,c,u,s,P[r+7],b,4249261313),s=v(s,l,c,u,P[r+8],C,1770035416),u=v(u,s,l,c,P[r+9],G,2336552879),c=v(c,u,s,l,P[r+10],k,4294925233),l=v(l,c,u,s,P[r+11],b,2304563134),s=v(s,l,c,u,P[r+12],C,1804603682),u=v(u,s,l,c,P[r+13],G,4254626195),c=v(c,u,s,l,P[r+14],k,2792965006),l=v(l,c,u,s,P[r+15],b,1236535329),s=w(s,l,c,u,P[r+1],T,4129170786),u=w(u,s,l,c,P[r+6],x,3225465664),c=w(c,u,s,l,P[r+11],y,643717713),l=w(l,c,u,s,P[r+0],D,3921069994),s=w(s,l,c,u,P[r+5],T,3593408605),u=w(u,s,l,c,P[r+10],x,38016083),c=w(c,u,s,l,P[r+15],y,3634488961),l=w(l,c,u,s,P[r+4],D,3889429448),s=w(s,l,c,u,P[r+9],T,568446438),u=w(u,s,l,c,P[r+14],x,3275163606),c=w(c,u,s,l,P[r+3],y,4107603335),l=w(l,c,u,s,P[r+8],D,1163531501),s=w(s,l,c,u,P[r+13],T,2850285829),u=w(u,s,l,c,P[r+2],x,4243563512),c=w(c,u,s,l,P[r+7],y,1735328473),l=w(l,c,u,s,P[r+12],D,2368359562),s=$(s,l,c,u,P[r+5],N,4294588738),u=$(u,s,l,c,P[r+8],R,2272392833),c=$(c,u,s,l,P[r+11],z,1839030562),l=$(l,c,u,s,P[r+14],B,4259657740),s=$(s,l,c,u,P[r+1],N,2763975236),u=$(u,s,l,c,P[r+4],R,1272893353),c=$(c,u,s,l,P[r+7],z,4139469664),l=$(l,c,u,s,P[r+10],B,3200236656),s=$(s,l,c,u,P[r+13],N,681279174),u=$(u,s,l,c,P[r+0],R,3936430074),c=$(c,u,s,l,P[r+3],z,3572445317),l=$(l,c,u,s,P[r+6],B,76029189),s=$(s,l,c,u,P[r+9],N,3654602809),u=$(u,s,l,c,P[r+12],R,3873151461),c=$(c,u,s,l,P[r+15],z,530742520),l=$(l,c,u,s,P[r+2],B,3299628645),s=S(s,l,c,u,P[r+0],E,4096336452),u=S(u,s,l,c,P[r+7],L,1126891415),c=S(c,u,s,l,P[r+14],U,2878612391),l=S(l,c,u,s,P[r+5],F,4237533241),s=S(s,l,c,u,P[r+12],E,1700485571),u=S(u,s,l,c,P[r+3],L,2399980690),c=S(c,u,s,l,P[r+10],U,4293915773),l=S(l,c,u,s,P[r+1],F,2240044497),s=S(s,l,c,u,P[r+8],E,1873313359),u=S(u,s,l,c,P[r+15],L,4264355552),c=S(c,u,s,l,P[r+6],U,2734768916),l=S(l,c,u,s,P[r+13],F,1309151649),s=S(s,l,c,u,P[r+4],E,4149444226),u=S(u,s,l,c,P[r+11],L,3174756917),c=S(c,u,s,l,P[r+2],U,718787259),l=S(l,c,u,s,P[r+9],F,3951481745),s=g(s,a),l=g(l,n),c=g(c,i),u=g(u,o);var j=I(s)+I(l)+I(c)+I(u);return j.toLowerCase()}};return e}])}(angular),angular.module("app").factory("orders",["$q","$http","localStorageService","$log",function(e,t,r,a){function n(e){var t=[];return angular.forEach(e,function(e){var r={};r={id:parseInt(e.ID),userId:parseInt(e.idUser),date:parseInt(e.Datum),totalPrice:parseFloat(e.Preis),articles:i(e.Bestellungsartikel)},t.push(r)}),t}function i(e){var t=[];return angular.forEach(e,function(e){var r={};r={id:parseInt(e.idArticle),quantity:parseInt(e.Anzahl),price:parseFloat(e.Preis),name:e.Name},t.push(r)}),t}function o(e){var t=r.get("articles")||{},a=[];return angular.forEach(e,function(e){var r={};t[e.itemId]&&(r={idArticle:e.itemId.toString(),Name:t[e.itemId].name,Anzahl:e.quantity.toString(),idOrder:"0",Preis:t[e.itemId].price.toString()},a.push(r))}),a}var s={};return s.addOrder=function(r){var n=e.defer(),i={ID:"0",idUser:r.userId.toString(),Datum:r.date.toString(),Preis:r.totalPrice.toString(),Bestellungsartikel:o(r.items)};return t.post("http://localhost:8080/rest/order/add",i).then(function(e){"Bestellung konnte nicht hinzugefügt werden"==e.data?(a.error("error adding order"),n.reject(e.data)):(a.info("order added"),n.resolve(e.data))},function(e){a.error("error adding order: ",e),n.reject(e.statusText)}),n.promise},s.getOrders=function(r){var i=e.defer();return t.get("http://localhost:8080/rest/order/get/"+r).then(function(e){if("Bestellungen konnten nicht geladen werden"==e.data)a.error("error loading orders"),i.reject(e.data);else{var t=n(e.data);a.info("orders loaded"),i.resolve(t)}},function(e){a.error("error loading orders: ",e),i.reject(e.statusText)}),i.promise},s}]),angular.module("app").factory("user",["$q","$http","md5","$log",function(e,t,r,a){function n(e){var t=[];return angular.forEach(e,function(e){var r={};r={id:parseInt(e.ID),userName:e.Benutzername,email:e.Email,role:e.Rolle},t.push(r)}),t}var i={};return i.addUser=function(r){var n=e.defer(),i={ID:"0",Benutzername:r.userName,Passwort:r.password,Email:r.email,Rolle:r.role};return t.post("http://localhost:8080/rest/user/add",i).then(function(e){"User konnte nicht angelegt werden"==e.data||"User existiert bereits"==e.data?(a.error("error adding user: ",e.data),n.reject(e.data)):(a.info("user added"),n.resolve(e.data))},function(e){a.error("error adding user: ",e),n.reject(e.statusText)}),n.promise},i.login=function(n){var i=e.defer();return t.get("http://localhost:8080/rest/user/get/"+n.userName).then(function(e){"User konnten nicht geladen werden"==e.data?(a.error("login failed - backend or database problem"),i.reject(e.data)):"null"==e.data.Benutzername?(a.warn("login failed - username not correct"),i.reject("Benutzer existiert nicht!")):e.data.Passwort===n.password?(a.info("user logged in"),i.resolve({role:e.data.Rolle,id:e.data.ID,password:r.createHash(e.data.Passwort)})):(a.warn("login failed - password is wrong"),i.reject("Passwort falsch!"))},function(e){a.error("login failed: ",e),i.reject(e.statusText)}),i.promise},i.getAllUsers=function(){var r=e.defer();return t.get("http://localhost:8080/rest/users/get").then(function(e){if("string"==typeof e.data)a.error("error getting all users: ",e.data),r.reject(e.data);else{a.info("users loaded");var t=n(e.data);r.resolve(t)}},function(e){a.error("error getting all users: ",e),r.reject(e)}),r.promise},i.authenticate=function(n,i){var o=e.defer();return t.get("http://localhost:8080/rest/user/get/"+n).then(function(e){"User konnten nicht geladen werden"==e.data?(a.error("authentication failed - backend or database problem"),o.reject(e.data)):"null"==e.data.Benutzername?(a.warn("authentication failed - user does not exist"),o.reject("Benutzer existiert nicht!")):r.createHash(e.data.Passwort)===i?(a.info("authentication was successful"),o.resolve({role:e.data.Rolle,id:parseInt(e.data.ID),userName:n,password:i})):(a.warn("authentication failed - password wrong"),o.reject("Authentifizierung fehlgeschlagen"))},function(e){a.warn("authentication failed: ",e),o.reject(e.statusText)}),o.promise},i.deleteUser=function(r){var n=e.defer();return t.get("http://localhost:8080/rest/user/delete/"+r).then(function(e){"User existiert nicht"==e.data||"Hat nicht funktioniert"==e.data?(a.error("error deleting user: ",e.data),n.reject(e.data)):(a.info("user deleted"),n.resolve(e.data))},function(e){a.error("error deleting user: ",e),e.statusText?n.reject(e.statusText):n.reject()}),n.promise},i}]),angular.module("app.topGames",[]).config(["$stateProvider",function(e){e.state("topGames",{url:"/topGames",templateUrl:"app/topGames/topGames.html",controller:"TopGamesCtrl"})}]).controller("TopGamesCtrl",["$scope","articles","localStorageService",function(e,t,r){e.topGameIds=r.get("top-games")||[],e.articles=r.get("articles")||{},t.getTopGames().then(function(){e.topGameIds=r.get("top-games")},function(e){toastr.error(e)}),t.getAllArticles().then(function(){e.articles=r.get("articles")},function(e){toastr.error(e)})}]),angular.module("app.userAdministration",[]).config(["$stateProvider",function(e){e.state("userAdministration",{url:"/userAdministration",templateUrl:"app/userAdministration/userAdministration.html",controller:"UserAdministrationCtrl"})}]).controller("UserAdministrationCtrl",["$scope","user","localStorageService","$state","$rootScope",function(t,r,a,n,i){function o(){r.getAllUsers().then(function(e){t.users=e},function(e){e?toastr.error(e):toastr.error("Ein unbekannter Fehler ist aufgetreten!")})}var s=a.get("user")||{};angular.equals({},s)?(toastr.info("Sie müssen sich einloggen, um diese Seite zu sehen"),n.go("login")):r.authenticate(s.userName,s.password).then(function(e){a.set("user",e),s=e,"admin"!=s.role?(toastr.info("Diese Seite ist geschützt!"),n.go("home")):o()},function(){toastr.error("Fehler bei der Authentifizierung"),toastr.warning("Sie werden nun automatisch ausgeloggt"),i.logout()}),t.deleteUser=function(t){var a=e.confirm("Wollen Sie den Benutzer "+t+" wirklich löschen?");a&&r.deleteUser(t).then(function(e){toastr.success(e),o()},function(e){toastr.error(e)})}}]),angular.module("app.checkout",[]).config(["$stateProvider",function(e){e.state("checkout",{url:"/checkout",templateUrl:"app/cart/checkout/checkout.html",controller:"CheckoutCtrl"})}]).controller("CheckoutCtrl",["$scope","localStorageService","$state","orders",function(e,t,r,a){e.isLoading=!1;var n=t.get("user")||{};n.userName||(t.set("fromCheckout",!0),toastr.info("Bitte melden Sie sich an."),r.go("login")),e.cart=t.get("cart")||{},angular.equals({},e.cart)&&r.go("home"),e.articles=t.get("articles")||{},e.updateTotalPrice=function(){e.totalPrice=0,angular.forEach(e.cart,function(t){e.totalPrice+=t.quantity*e.articles[t.itemId].price})},e.addOrder=function(){e.isLoading=!0;var i=t.get("cart"),o={userId:n.id,date:(new Date).getTime(),totalPrice:e.totalPrice,items:i};a.addOrder(o).then(function(a){e.isLoading=!1,toastr.success(a),t.remove("cart"),r.go("orders")},function(t){e.isLoading=!1,t?toastr.error(t):toastr.error("Ein unbekannter Fehler ist aufgetreten!")})},e.updateTotalPrice()}]),angular.module("app.gameDetail").controller("RatingCtrl",["$scope","$uibModalInstance","stars","title","message",function(e,t,r,a,n){e.stars=r,e.message=n,e.title=a,a?e.isNewReview=!1:e.isNewReview=!0,e.isTitleTouched=!1,e.isMessageTouched=!1,e.titleRegex=/^.{4,100}$/,e.messageRegex=/^.{4,1000}$/,e.checkValid=function(){e.message&&e.title&&e.titleRegex.test(e.title)&&e.messageRegex.test(e.message)?e.isValid=!0:e.isValid=!1},e.checkValid(),e.submit=function(){var r={title:e.title,message:e.message,stars:e.stars};t.close(r)},e.cancel=function(){t.dismiss()}}]),angular.module("app.register",[]).config(["$stateProvider",function(e){e.state("register",{url:"/register",templateUrl:"app/login/register/register.html",controller:"RegisterCtrl"})}]).controller("RegisterCtrl",["$scope","user","$state",function(e,t,r){e.data={},e.data.userName="",e.data.email="",e.data.password="",e.data.passwordConfirm="",e.isTouched=!1,e.isLoading=!1,e.pattern=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,e.userRegex=/^[a-zA-Z0-9äöüÄÖÜ._-]{4,20}$/,e.passwordRegex=/^[a-zA-Z0-9äöüÄÖÜ._-]{6,20}$/,$("#form").keydown(function(e){13==e.keyCode&&$("#submit").click()}),e.register=function(){if(e.isTouched=!0,e.data.userName&&e.data.password&&e.data.passwordConfirm)if(e.userRegex.test(e.data.userName))if(!e.data.email||!e.pattern.test(e.data.email)||e.data.email>60)toastr.warning("Die Email-Adresse ist ungültig!","Fehlerhafte Informationen!");else if(e.data.password!=e.data.passwordConfirm)toastr.warning("Die Passwörter stimmen nicht überein.","Fehlerhafte Informationen!");else if(e.passwordRegex.test(e.data.password)){e.isLoading=!0;var a={userName:e.data.userName,password:e.data.password,email:e.data.email,role:"user"};t.addUser(a).then(function(){e.isLoading=!1,toastr.success("Der Benutzer wurde erfolgreich angelegt!"),r.go("login"),toastr.info("Bitte loggen Sie sich mit den neuen Daten an.")},function(t){e.isLoading=!1,t?toastr.error(t):toastr.error("Fehler bei der Verbindung zum Server!")})}else toastr.warning("Passwort zu kurz!");else toastr.warning("Der Benutzername darf nur bestimmte Sonderzeichen enthalten und muss zwischen 4 und 20 Zeichen lang sein!");else toastr.warning("Alle Felder müssen ausgefüllt werden!","Fehlende Informationen!")}}])}(window,document);
//# sourceMappingURL=app.min.js.map
